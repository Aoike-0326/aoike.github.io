<body>
  <h1>方位センサーテスト</h1>
  <button id="start">スタート</button>
  <img id="arrow" src="..." style="width:100px;" />
  <p id="heading">読み取り待ち...</p>

  <script>
    const startBtn = document.getElementById('start');
    const arrow = document.getElementById('arrow');
    const headingText = document.getElementById('heading');

    function updateHeading(alpha) {
      const heading = 360 - alpha;
      arrow.style.transform = `rotate(${heading}deg)`;
      headingText.textContent = `方位: ${Math.round(heading)}°`;
    }

    function handleOrientation(event) {
      if (event.alpha != null) {
        updateHeading(event.alpha);
      }
    }

    startBtn.addEventListener('click', () => {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        DeviceOrientationEvent.requestPermission()
          .then(permissionState => {
            if (permissionState === 'granted') {
              window.addEventListener('deviceorientation', handleOrientation);
              startBtn.remove(); // ボタンを消す
            } else {
              alert('センサー使用が許可されませんでした');
            }
          })
          .catch(console.error);
      } else {
        // Androidなど
        window.addEventListener('deviceorientation', handleOrientation);
        startBtn.remove();
      }
    });
  </script>
</body>
